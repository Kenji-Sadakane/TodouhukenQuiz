<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="manifest.json">
    <title>都道府県シルエットクイズ</title>
    <style>
      .canvasArea {
        text-align: center;
        padding-top: 20px;
        padding-bottom: 20px;
      }
      .answerTable td {
        padding-left: 5px;
        padding-right: 5px;
        padding-bottom: 10px;
      }
      .buttonnGradientRadius {
        display: inline-block;
        padding: 7px 20px;
        border-radius: 25px;
        text-decoration: none;
        color: #000000;
        background-image: linear-gradient(45deg, #FFC1F7 0%, #FFFFFF 100%);
        transition: .4s;
        width: 150px;
      }
    </style>
  </head>
  <body>
    <div style="text-align: right">
      <span id="okCount">連続正解数: 0</span>
    </div>
    <hr>
    <span>Q 次の画像の都道府県名は何でしょうか？</span>
    <div class="canvasArea">
      <canvas id="prefectureImage" width="200" height="200"></canvas>
    </div>
      <table align="center" class="answerTable">
        <tr>
          <td><input type="button" id="answer1" class="answer buttonnGradientRadius" value="北海道"></td>
          <td><input type="button" id="answer2" class="answer buttonnGradientRadius" value="青森県"></td>
        </tr>
        <tr>
          <td><input type="button" id="answer3" class="answer buttonnGradientRadius" value="岩手県"></td>
          <td><input type="button" id="answer4" class="answer buttonnGradientRadius" value="宮城県"></td>
        </tr>
      </table>
    <script>
      // service workerの登録関係
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service_worker.js').then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }).catch(function(err) {
            console.log('ServiceWorker registration failed: ', err);
        });
      }

      // 都道府県リスト
      const prefectures = [
        { no: 1, name: "北海道", url:"td01_hokkaido_black.jpg"},
        { no: 2, name: "青森県", url: "td02_aomori_black.jpg" },
        { no: 3, name: "岩手県", url: "td03_iwate_black.jpg" },
        { no: 4, name: "宮城県", url: "td04_miyagi_black.jpg" },
        { no: 5, name: "秋田県", url: "td05_akita_black.jpg" },
        { no: 6, name: "山形県", url: "td06_yamagata_black.jpg" },
        { no: 7, name: "福島県", url: "td07_hukushima_black.jpg" },
        { no: 8, name: "茨城県", url: "td08_ibaraki_black.jpg" },
        { no: 9, name: "栃木県", url: "td09_tochigi_black.jpg" },
        { no: 10, name: "群馬県", url: "td10_gunma_black.jpg" },
        { no: 11, name: "埼玉県", url: "td11_saitama_black.jpg" },
        { no: 12, name: "千葉県", url: "td12_chiba_black.jpg" },
        { no: 13, name: "東京都", url: "td13_tokyo_black.jpg" },
        { no: 14, name: "神奈川県", url: "td14_kanagawa_black.jpg" },
        { no: 15, name: "新潟県", url: "td15_niigata_black.jpg" },
        { no: 16, name: "富山県", url: "td16_toyama_black.jpg" },
        { no: 17, name: "石川県", url: "td17_ishikawa_black.jpg" },
        { no: 18, name: "福井県", url: "td18_hukui_black.jpg" },
        { no: 19, name: "山梨県", url: "td19_yamanashi_black.jpg" },
        { no: 20, name: "長野県", url: "td20_nagano_black.jpg" },
        { no: 21, name: "岐阜県", url: "td21_gihu_black.jpg" },
        { no: 22, name: "静岡県", url: "td22_shizuoka_black.jpg" },
        { no: 23, name: "愛知県", url: "td23_aichi_black.jpg" },
        { no: 24, name: "三重県", url: "td24_mie_black.jpg" },
        { no: 25, name: "滋賀県", url: "td25_shiga_black.jpg" },
        { no: 26, name: "京都府", url: "td26_kyoto_black.jpg" },
        { no: 27, name: "大阪府", url: "td27_oosaka_black.jpg" },
        { no: 28, name: "兵庫県", url: "td28_hyogo_black.jpg" },
        { no: 29, name: "奈良県", url: "td29_nara_black.jpg" },
        { no: 30, name: "和歌山県", url: "td30_wakayama_black.jpg" },
        { no: 31, name: "鳥取県", url: "td31_tottori_black.jpg" },
        { no: 32, name: "島根県", url: "td32_shimane_black.jpg" },
        { no: 33, name: "岡山県", url: "td33_okayama_black.jpg" },
        { no: 34, name: "広島県", url: "td34_hiroshima_black.jpg" },
        { no: 35, name: "山口県", url: "td35_yamaguchi_black.jpg" },
        { no: 36, name: "徳島県", url: "td36_tokushima_black.jpg" },
        { no: 37, name: "香川県", url: "td37_kagawa_black.jpg" },
        { no: 38, name: "愛媛県", url: "td38_ehime_black.jpg" },
        { no: 39, name: "高知県", url: "td39_kouchi_black.jpg" },
        { no: 40, name: "福岡県", url: "td40_hukuoka_black.jpg" },
        { no: 41, name: "佐賀県", url: "td41_saga_black.jpg" },
        { no: 42, name: "長崎県", url: "td42_nagasaki_black.jpg" },
        { no: 43, name: "熊本県", url: "td43_kumamoto_black.jpg" },
        { no: 44, name: "大分県", url: "td44_ooita_black.jpg" },
        { no: 45, name: "宮崎県", url: "td45_miyazaki_black.jpg" },
        { no: 46, name: "鹿児島県", url: "td46_kagoshima_black.jpg" },
        { no: 47, name: "沖縄県", url: "td47_okinawa_black.jpg" }
      ];
      // 問題配列
      let questions = [  0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                        10,11,12,13,14,15,16,17,18,19,
                        20,21,22,23,24,25,26,27,28,29,
                        30,31,32,33,34,35,36,37,38,39,
                        40,41,42,43,44,45,46
                      ];
      // 問題番号
      let questionIdx = 0;

      // 配列のシャッフル
      const arrayShuffle = (array) => {
        let length = array.length;
        while(length > 0) {
          var random = Math.floor(Math.random() * length);
          var tmp = array[length - 1];
          array[length - 1] = array[random];
          array[random] = tmp;
          length -= 1;
        }
      }

      // 問題の画像描画
      const drawCanvas = (url) => {
        var canvas = document.getElementById('prefectureImage');
        var ctx = canvas.getContext('2d');
        var img = new Image();
        img.src = url;
        img.onload = () => {
          ctx.drawImage(img, 0, 0, 192, 192);
        }
      }

      // 回答リスト生成
      const setAnswerList = (answerNo, questions) => {
        let answerList = questions
          .filter((e) => e !== answerNo )
          .slice(0, 3);
        answerList.push(answerNo);
        arrayShuffle(answerList);
        console.log(answerList);
        document.getElementById('answer1').value = prefectures[answerList[0]]["name"];
        document.getElementById('answer2').value = prefectures[answerList[1]]["name"];
        document.getElementById('answer3').value = prefectures[answerList[2]]["name"];
        document.getElementById('answer4').value = prefectures[answerList[3]]["name"];
      }

      // 問題生成
      const setupQuestion = () => {
        let answerPrefecture = prefectures[questions[questionIdx]];
        drawCanvas("img/" + answerPrefecture["url"]);
        setAnswerList(questions[questionIdx], questions);
        console.log(answerPrefecture);
      }

      // 正誤判定
      const judge = (name) => {
        return prefectures[questions[questionIdx]]["name"] === name;
      }

      // 回答クリック時の処理
      Array.from(document.getElementsByClassName('answer')).forEach((answer) => {
        answer.addEventListener("click", (e) => {
          if (judge(answer.value)) {
            questionIdx++;
            if (questionIdx < 47) {
              document.getElementById('okCount').innerHTML = "連続正解数: " + questionIdx;
              // 次の問題設定
              setupQuestion();
            } else {
              alert("全問正解 おめでとう！");
              location.reload();
            }
          } else {
            alert("不正解");
            location.reload();
          }
        }, false);
      });

      // 問題順序設定(初回のみ実行)
      arrayShuffle(questions);
      // 問題生成
      setupQuestion();

    </script>
  </body>
</html>